#!/bin/bash

main() {
    svn ls -R "$@" | while read file; do
        [[ -f $file ]]                 || continue
        [[ $(file "$file") = *text* ]] || continue

        printf '%-40s %s\n' "$file:" "$(blame "$file" | paste -s)"
    done
}

blame() {
    local file=$1

    svn blame "$file" | while read num name line; do
        [[ $line =~ ^[{\ }]*$ ]]              && continue
        [[ $num = 39 && $name = jschneider ]] && name='<pre-svn>'

        echo "$name"
    done | sort | uniq -c | sort -k1 -rn
}

main "$@"
