#!/bin/bash
#
# Usage: cvsfind [-H] [-L] [-P] [path...] [expression]
#
# Attempts to behave identically to a plain `find' command while ignoring CVS
# directories. Usage is identical to `find'.
#
# To use copy this script to your ~/bin/ directory.

OPTIONS=()
PATHS=()
EXPROPTIONS=()
EXPR=()

while [[ $1 =~ ^-[HLP]+ ]]; do
    OPTIONS+=("$1")
    shift
done

while [[ $# -gt 0 && ! $1 =~ ^[-\(\),!] ]]; do
    PATHS+=("$1")
    shift
done

# If any of these options are specified keep them at the front of the expression.
while (($# > 0)); do
    case "$1" in
        -d|-daystart|-depth|-follow|-help|--help|-ignore_readdir_race|-mount|-noignore_readdir_race|-noleaf|-version|--version|-warn|-nowarn|-xautofs|-xdev)
            EXPROPTIONS+=("$1")
            shift 1;;

        -mindepth|-maxdepth|-regextype)
            EXPROPTIONS+=("$1" "$2")
            shift 2;;

        *)
            break;;
    esac
done

# If user's expression contains no action then we'll add the normally-implied
# `-print'.
ACTION=-print

while (($# > 0)); do
    case "$1" in
       -delete|-exec|-execdir|-fls|-fprint|-fprint0|-fprintf|-ok|-print|-okdir|-print0|-printf|-prune|-quit|-ls)
            ACTION=;;
    esac

    EXPR+=("$1")
    shift
done

if [[ ${#EXPR} -eq 0 ]]; then
    EXPR=(-true)
fi
    
exec -a "$(basename "$0")" find "${OPTIONS[@]}" "${PATHS[@]}" "${EXPROPTIONS[@]}" -name CVS -type d -prune -o '(' "${EXPR[@]}" ')' $ACTION
